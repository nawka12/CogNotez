<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CogNotez - AI-Powered Notes</title>
    <script>
        // Apply theme immediately to prevent flashbang
        (function() {
            const theme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', theme);
        })();
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="./css/styles.css">
    <link rel="stylesheet" href="./css/themes.css">
</head>
<body>
    <!-- Splash Screen -->
    <div id="splash-screen" class="splash-screen">
        <div class="splash-content">
            <div class="splash-logo">
                <div class="splash-icon"><img src="../assets/icon.svg" alt="CogNotez Logo" width="64" height="64"></div>
                <h1 class="splash-title">CogNotez</h1>
                <p class="splash-subtitle">AI-Powered Note App</p>
            </div>
            <div class="splash-progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <div class="progress-text" id="progress-text">Initializing...</div>
            </div>
            <div class="splash-footer">
                <p class="splash-version" id="splash-version">Version</p>
                <div class="splash-spinner"></div>
            </div>
        </div>
    </div>

    <div id="app" class="app-hidden">
        <!-- Header -->
        <header class="app-header">
            <div class="header-left">
                <div class="app-title-container">
                    <img src="../assets/icon.svg" alt="CogNotez Logo" class="app-logo" width="32" height="32">
                    <h1 class="app-title">CogNotez</h1>
                </div>
                <div class="search-container">
                    <input type="text" id="search-input" placeholder="Search notes..." class="search-input">
                    <button id="search-button" class="search-button"><i class="fas fa-search"></i></button>
                </div>
            </div>
            <div class="header-right">
                <!-- Simplified Sync Button (hidden until sync is enabled) -->
                <button id="sync-btn" class="sync-btn hidden" title="Sync status - Click to sync">
                    <i class="fas fa-cloud" id="sync-btn-icon"></i>
                    <span class="sync-btn-text" id="sync-btn-text">Sync</span>
                </button>
                
                <button id="theme-toggle" class="theme-toggle-btn" title="Toggle theme">
                    <span class="theme-icon-light"><i class="fas fa-sun"></i></span>
                    <span class="theme-icon-dark"><i class="fas fa-moon"></i></span>
                </button>
                <button id="ai-toggle-btn" class="ai-toggle-btn" title="Toggle AI Assistant"><i class="fas fa-robot"></i></button>
                <button id="new-note-btn" class="new-note-btn" title="New note"><i class="fas fa-plus"></i></button>
                <button id="header-overflow-btn" class="header-overflow-btn" title="More options"><i class="fas fa-ellipsis-v"></i></button>
                
                <!-- Header Overflow Menu -->
                <div id="header-overflow-menu" class="header-overflow-menu hidden">
                    <button id="advanced-search-btn" class="header-overflow-item" title="Advanced Search"><i class="fas fa-filter"></i> Advanced Search</button>
                    <button id="templates-btn" class="header-overflow-item" title="Templates"><i class="fas fa-file-alt"></i> Templates</button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Sidebar -->
            <aside class="sidebar">
                <div class="sidebar-header">
                    <h2>Notes</h2>
                    <button id="sidebar-toggle" class="sidebar-toggle"><i class="fas fa-bars"></i></button>
                </div>
                <div class="notes-list" id="notes-list">
                    <!-- Notes will be populated here -->
                </div>
            </aside>

            <!-- Main Content Area -->
            <section class="main-content-area">
                <!-- Editor Area -->
                <div class="editor-container" id="editor-container">
                    <div class="editor-header">
                        <div class="note-info">
                            <input type="text" id="note-title" placeholder="Note title..." class="note-title-input">
                            <div id="note-tags-display" class="note-tags-display"></div>
                            <span id="note-date" class="note-date"></span>
                        </div>
                        <div class="editor-actions">
                            <button id="undo-btn" class="action-btn" title="Undo (Ctrl+Z)"><i class="fas fa-undo"></i></button>
                            <button id="redo-btn" class="action-btn" title="Redo (Ctrl+Y)"><i class="fas fa-redo"></i></button>
                            <button id="preview-toggle-btn" class="action-btn" title="Toggle Preview/Edit"><i class="fas fa-edit"></i></button>
                            <button id="save-btn" class="action-btn" title="Save"><i class="fas fa-save"></i></button>
                            <button id="editor-overflow-btn" class="action-btn" title="More options"><i class="fas fa-ellipsis-v"></i></button>
                            
                            <!-- Overflow menu -->
                            <div id="editor-overflow-menu" class="editor-overflow-menu hidden">
                                <button id="find-btn" class="overflow-menu-item" title="Find (Ctrl+F)"><i class="fas fa-search"></i> Find</button>
                                <button id="replace-btn" class="overflow-menu-item" title="Replace (Ctrl+H)"><i class="fas fa-exchange-alt"></i> Replace</button>
                                <div class="overflow-menu-separator"></div>
                                <button id="ai-summary-btn" class="overflow-menu-item" title="AI Summary"><i class="fas fa-file-alt"></i> AI Summary</button>
                                <button id="generate-tags-btn" class="overflow-menu-item" title="Generate Tags"><i class="fas fa-tags"></i> Generate Tags</button>
                                <button id="manage-tags-btn" class="overflow-menu-item" title="Manage Tags"><i class="fas fa-clipboard-list"></i> Manage Tags</button>
                                <div class="overflow-menu-separator"></div>
                                <button id="export-btn" class="overflow-menu-item" title="Export"><i class="fas fa-download"></i> Export</button>
                                <button id="share-btn" class="overflow-menu-item" title="Share"><i class="fas fa-share"></i> Share</button>
                                <button id="password-lock-btn" class="overflow-menu-item" title="Password Protection"><i class="fas fa-lock"></i> Password Lock</button>
                            </div>
                        </div>
                    </div>
                    <div class="editor-wrapper">
                        <textarea id="note-editor" class="note-editor hidden" placeholder="Start writing your note..."></textarea>
                        <div id="markdown-preview" class="markdown-preview"></div>
                    </div>

                    <!-- AI Edit Approval (Inline) -->
                    <div id="ai-edit-approval-inline" class="ai-edit-approval-inline hidden">
                        <div class="ai-edit-approval-header">
                            <h3>Review AI Edits</h3>
                            <div class="approval-header-actions">
                                <button id="ai-edit-help-btn" class="approval-help-btn" title="Help"><i class="fas fa-question-circle"></i></button>
                                <button id="ai-edit-approval-close" class="approval-close-btn" title="Close"><i class="fas fa-times"></i></button>
                            </div>
                        </div>
                        <div class="ai-edit-approval-body">
                            <div class="ai-edit-instructions">
                                <div class="bulk-actions">
                                    <button id="accept-changes-btn" class="btn-success">Accept All</button>
                                    <button id="reject-changes-btn" class="btn-secondary">Reject All</button>
                                </div>
                            </div>
                            <div class="ai-edit-diff-container">
                                <div class="diff-content" id="ai-edit-diff-content">
                                    <!-- Diff content will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- No Note Selected Placeholder -->
                <div class="no-note-placeholder hidden" id="no-note-placeholder">
                    <div class="placeholder-content">
                        <div class="placeholder-icon"><i class="fas fa-sticky-note"></i></div>
                        <h2 class="placeholder-title">Select a note to start</h2>
                        <p class="placeholder-description">Choose a note from the sidebar or create a new one to begin writing</p>
                        <button id="create-first-note-btn" class="create-note-btn">
                            <span class="btn-icon"><i class="fas fa-plus"></i></span>
                            Create New Note
                        </button>
                    </div>
                </div>
            </section>

            <!-- AI Panel (hidden by default) -->
            <aside class="ai-panel hidden" id="ai-panel">
                <div class="ai-panel-header">
                    <h3>AI Assistant</h3>
                    <div class="ai-panel-actions">
                        <button id="ai-reset-btn" class="ai-reset-btn" title="New Chat"><i class="fas fa-plus-circle"></i></button>
                        <button id="ai-panel-close" class="ai-panel-close"><i class="fas fa-times"></i></button>
                    </div>
                </div>
                <div class="ai-panel-content">
                    <div id="ai-messages" class="ai-messages">
                        <!-- AI conversation will appear here -->
                    </div>
                    <div class="ai-input-container">
                        <input type="text" id="ai-input" placeholder="Ask me anything..." class="ai-input">
                        <button id="ai-send-btn" class="ai-send-btn">Send</button>
                    </div>
                </div>
            </aside>
        </main>

        <!-- Context Menu (hidden) -->
        <div id="context-menu" class="context-menu hidden">
            <!-- Standard operations -->
            <div class="context-menu-item" data-action="cut"><i class="fas fa-cut"></i> Cut</div>
            <div class="context-menu-item" data-action="copy"><i class="fas fa-copy"></i> Copy</div>
            <div class="context-menu-item" data-action="paste"><i class="fas fa-paste"></i> Paste</div>
            <div class="context-menu-item" data-action="generate-ai"><i class="fas fa-magic"></i> Generate with AI</div>
            <div class="context-menu-item" data-action="download-media"><i class="fas fa-download"></i> Download</div>
            <div class="context-menu-separator"></div>
            <!-- AI operations (shown only when text is selected) -->
            <div class="context-menu-item context-menu-ai" data-action="summarize"><i class="fas fa-file-alt"></i> Summarize</div>
            <div class="context-menu-item context-menu-ai" data-action="ask-ai"><i class="fas fa-robot"></i> Ask AI</div>
            <div class="context-menu-item context-menu-ai" data-action="edit-ai"><i class="fas fa-edit"></i> Edit with AI</div>
        </div>

        <!-- Modals/Dialogs -->
        <div id="ai-dialog" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="ai-dialog-title">AI Assistant</h3>
                    <button id="ai-dialog-close" class="modal-close"><i class="fas fa-times"></i></button>
                </div>
                <div class="modal-body">
                    <div id="ai-dialog-context" class="ai-dialog-context"></div>
                    <input type="text" id="ai-dialog-input" placeholder="What would you like to do?" class="ai-dialog-input">
                    <div class="ai-dialog-actions">
                        <button id="ai-dialog-cancel" class="btn-secondary">Cancel</button>
                        <button id="ai-dialog-submit" class="btn-primary">Submit</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div id="loading-overlay" class="loading-overlay hidden">
            <div class="loading-spinner"></div>
            <div class="loading-text">Processing with AI...</div>
        </div>

        <!-- Advanced Search Panel -->
        <div id="advanced-search-panel" class="advanced-search-panel hidden">
            <div class="advanced-search-header">
                <h3>Advanced Search</h3>
                <button id="advanced-search-close" class="advanced-search-close"><i class="fas fa-times"></i></button>
            </div>
            <div class="advanced-search-body">
                <div class="search-filter-group">
                    <label>Search Text</label>
                    <input type="text" id="filter-text" placeholder="Search in title, content, tags..." class="filter-input">
                </div>
                <div class="search-filter-group">
                    <label>Filter by Tags</label>
                    <select id="filter-tags" multiple class="filter-select">
                        <!-- Tags will be populated dynamically -->
                    </select>
                </div>
                <div class="search-filter-group">
                    <label>Date Range</label>
                    <div class="date-range-inputs">
                        <input type="date" id="filter-date-from" class="filter-input-date" placeholder="From">
                        <span>to</span>
                        <input type="date" id="filter-date-to" class="filter-input-date" placeholder="To">
                    </div>
                </div>
                <div class="search-filter-group">
                    <label>Filter Options</label>
                    <div class="filter-checkboxes">
                        <label><input type="checkbox" id="filter-favorites"> Favorites only</label>
                        <label><input type="checkbox" id="filter-pinned"> Pinned only</label>
                        <label><input type="checkbox" id="filter-protected"> Password protected</label>
                    </div>
                </div>
                <div class="search-filter-group">
                    <label>Sort By</label>
                    <select id="filter-sort" class="filter-select">
                        <option value="updated_at_desc">Last Modified (Newest)</option>
                        <option value="updated_at_asc">Last Modified (Oldest)</option>
                        <option value="created_at_desc">Created (Newest)</option>
                        <option value="created_at_asc">Created (Oldest)</option>
                        <option value="title_asc">Title (A-Z)</option>
                        <option value="title_desc">Title (Z-A)</option>
                        <option value="word_count_desc">Word Count (High to Low)</option>
                        <option value="word_count_asc">Word Count (Low to High)</option>
                    </select>
                </div>
                <div class="advanced-search-actions">
                    <button id="apply-filters-btn" class="btn-primary">Apply Filters</button>
                    <button id="clear-filters-btn" class="btn-secondary">Clear All</button>
                </div>
                <div class="search-results-summary">
                    <span id="search-results-count">0 notes found</span>
                </div>
            </div>
        </div>

        <!-- Template Chooser Dialog -->
        <div id="template-chooser" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Choose a Template</h3>
                    <button id="template-chooser-close" class="modal-close"><i class="fas fa-times"></i></button>
                </div>
                <div class="modal-body">
                    <div class="template-grid" id="template-grid">
                        <!-- Templates will be populated here -->
                    </div>
                    <div class="template-actions">
                        <button id="create-custom-template-btn" class="btn-secondary"><i class="fas fa-plus"></i> Create Custom Template</button>
                        <button id="generate-ai-template-btn" class="btn-primary"><i class="fas fa-robot"></i> Generate Template with AI</button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script src="./js/database.js"></script>
    <script src="./js/encryption.js"></script>
    <script src="./js/network-utils.js"></script>
    <script src="./js/backend.js"></script>
    <script src="./js/scraper.js"></script>
    <!-- Phase 5 Modules -->
    <script src="./js/advanced-search.js"></script>
    <script src="./js/templates.js"></script>
    <script src="./js/rich-media.js"></script>
    <!-- End Phase 5 -->
    <script src="./js/app.js"></script>
    <script src="./js/notes.js"></script>
    <script src="./js/ai-edit-approval.js"></script>
    <script src="./js/ai.js"></script>
    <script src="./js/ui.js"></script>
</body>
</html>
